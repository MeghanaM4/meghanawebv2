---
import Layout from "../layouts/Layout.astro";
import "../styles/global.css";
import "../styles/projects.css";
import Card from "../components/Card.astro";
import data from "../data/projects.json";
import Footer from "../components/Footer.astro";
---

<Layout>
  <div
    style="background-image: url('/noise.webp');"
    class="fixed inset-0 bg-center bg-no-repeat bg-cover overflow-y-auto overflow-x-hidden"
  >
    <div>
      <div class="pt-2 flex items-center">
        <p
          style="font-family:static"
          class="text-[4em] tracking-[0.7rem] pl-8 text-[#C4CDDE]"
        >
          projects
        </p>

        <!-- 
        // From Uiverse.io by alexruix
        <label
          class="absolute top-0 right-8 h-8 w-12 cursor-pointer [-webkit-tap-highlight-color:_transparent]"
          for="switch"
        >
          <input
            class="peer sr-only"
            id="switch"
            type="checkbox"
            onclick="toggleDither()"
          />

          <span class="absolute inset-0 m-auto h-2 rounded-full bg-stone-400"
          ></span>

          <span
            class="absolute inset-y-0 start-0 m-auto size-6 rounded-full bg-stone-600 transition-all peer-checked:start-6 peer-checked:[&_>_*]:scale-0"
          >
            <span
              class="absolute inset-0 m-auto size-4 rounded-full bg-stone-300 transition"
            >
            </span>
          </span>
          <p class="text-white text-xs whitespace-nowrap mt-[1.5rem]">
            toggle dither
          </p>
        </label> -->

        <div
          class="flex flex-wrap text-right text-balance pl-[20%] pr-8 text-[#C4CDDE] text-[1.5em] gap-[0.4em]"
          style="font-family:lunchtype; font-weight: 700;"
        >
          <p
            id="projects"
            onclick="setFilter('projects')"
            class="hover-underline"
          >
            all projects
          </p>
          <p
            id="favorites"
            onclick="setFilter('favorites')"
            class="hover-underline"
          >
            favorites
          </p>
          <p
            id="hack club"
            onclick="setFilter('hack club')"
            class="hover-underline"
          >
            hack club
          </p>
          <p
            id="hardware"
            onclick="setFilter('hardware')"
            class="hover-underline"
          >
            hardware
          </p>
          <p
            id="hackathons"
            onclick="setFilter('hackathons')"
            class="hover-underline"
          >
            hackathons
          </p>
        </div>
      </div>
    </div>

    <a
      href="./terminal"
      class="fixed bottom-[1rem] rounded-[5rem] w-[3rem] aspect-square bg-[#FDC576]
      ml-[1rem] z-5 flex items-center justify-center"
    >
      <svg
        xmlns="http://www.w3.org/2000/svg"
        height="32"
        width="32"
        viewBox="0 0 24 24"
        ><!-- Icon from NRK Core Icons by Norsk rikskringkasting - https://creativecommons.org/licenses/by/4.0/ -->
        <path
          fill="#FFFFFF"
          d="M4.4 7.4L6.8 4h2.5L7.2 7h6.3a6.5 6.5 0 0 1 0 13H9l1-2h3.5a4.5 4.5 0 1 0 0-9H7.2l2.1 3H6.8L4.4 8.6L4 8z"
        ></path></svg
      >
    </a>

    <div class="flex w-screen items-center justify-center mt-4 px-4">
      <div
        id="card-container"
        class="columns-1 md:columns-2 lg:columns-3 gap-[3rem] w-full max-w-[90%] mx-auto"
      >
        {data.map((project) => <Card project={project} />)}
      </div>
    </div>

    <Footer />
  </div>

  <script>
    import { DISPLAYFORMAT_LDR_SRGB } from "playcanvas";

    let userFilter = "";

    function setFilter(filter: string) {
      userFilter = filter;
    }

    // function populateCards(filter: string) {
    //   const cardContainer = document.getElementById('card-container');
    //   cardContainer.innerHTML = {data.filter((projects) => projects.filters.includes(filter))
    //     .map((project) => <Card project={project} />)
    //   }
    // }

    function openModal() {
      const hash = window.location.hash.substring(1);
      console.log(hash);
      document.querySelectorAll("dialog").forEach((dialog) => {
        dialog.close();
        dialog.classList.add("hidden");
      });
      if (hash) {
        const modal = document.getElementById(hash) as HTMLDialogElement;
        if (modal) {
          modal.showModal();
          modal.classList.remove("hidden");
        }
      }
    }

    document.addEventListener("DOMContentLoaded", openModal);

    window.addEventListener("hashchange", openModal);

    document.querySelectorAll("dialog").forEach((dialog) => {
      dialog.addEventListener("close", () => {
        if (window.location.hash === `#${dialog.id}`) {
          history.pushState("", document.title, window.location.pathname);
        }
      });
    });
  </script>
</Layout>
